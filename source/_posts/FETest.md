---
title: 前端自动化测试
date: 2016-08-25 20:53:15
type: "categories"
categories: "前端自动化测试"
tags:
---

# 什么是自动化测试

顾名思义，自动化测试就是让我们从手工的劳动中解放出来，让机器代我们去做一些事情。人力成本，总是有限的，况且难免出错。

自动化测试也是软件工程化的一部分。

## 什么样的项目适合自动化测试

并不是所有的项目都适合自动化测试，甚至一个项目里面可能只有20%的代码适合自动化测试。
自动化测试不是神，它是有成本的，并不是说你做自动化测试就一定会有收益。

成本:

* 测试环境的搭建和管理
* 测试环境的检查，监控和报警
* 测试代码的编译和测试构建
* 测试代码的静态检查和报警
* 测试用例的分发和执行
* 测试结果的保存与管理
* 测试报告的生成
* 测试优先级的建议


解读：

- 自动化的**收益与项目迭代次数**成正比
- 自动化收益可能为负数：即当**自动化成本**和**维护成本**比手动**执行成本**还高时
- 很多时候自动化成本并不比手动成本高，但是维护成本很高

### 适合的场景

让收益最大化原则，我们设想的合适场景是:

* 以**回归测试**为主的项目。即需要长期做支持维护的产品。(迭代次数高)
* **接口**比较稳定的产品。(维护成本低)
* 手动测试特别费时费力，甚至无法达到测试目的的项目。比如**压力测试**，大数据或者大量重复数据测试，必须有自动化工具的支持。(手工成本高)
* **覆盖性测试**，避免遗漏边界情况(手工成本高)

## 前端自动化测试的难点
近几年前端发展迅猛，前端越来越工程化，自动化。自动化测试是工程化中必不可少的一部分。
但是前端代码80%都是与GUI的相关的业务代码。从本质上来说，前端是一种特殊的**GUI软件**。API测试方法论在测试GUI时并不能解决所有问题。GUI测试的成本非常高:

1. 它的输入输出不明确,不好写case

2. 它的迭代速度很快，case的维护成本非常高。

所以针对那相对稳定的20%,我们可以采用API测试，以及模拟测试。而剩下的80%，主要还是靠人力测试。

## 针对80%的测试

针对这部分的自动化测试，更多的是辅助测试。缩小测试范围，最后由人工测试。

#### 1、页面差异监控

基于dom树的diff，原理是利用phantomjs等无头浏览器，访问页面，遍历整个dom树，	构造出一个json结构。每次diff这个json，来对比差异。用于缩小回归范围。

## 针对20%的测试

#### 1、单测

> [jasmine](http://jasmine.github.io/edge/introduction.html)

![](http://o99eh3ii0.bkt.clouddn.com//16-8-28/59843772.jpg)
jasmine 是一个bdd驱动的测试框架,自带**断言库**
支持部分函数spy，stub，mock的能力
支持异步测试

> 总结: 在浏览器上做单元测试是比较好的，但是与别的工具整合有些麻烦，需要自行实现reporter

___

> [mocha](http://mochajs.org/)

![](http://o99eh3ii0.bkt.clouddn.com//16-8-28/96121519.jpg)
mocha 是一个功能丰富的js测试框架，可以有BDD和TDD的测试风格。
支持nodejs,浏览器端测试
支持异步测试
支持任意断言库

> 总结: **功能完善，可配置性强,与其他工具整合方便，也需要自实现报表**

___

#### 2、端测

> [phantomjs](https://www.npmjs.com/package/karma)

PhantomJS 是一个基于 WebKit的无头浏览器。原生支持各种web标准:  DOM 处理, CSS 选择器, JSON, Canvas, 和 SVG 。 PhantomJS 可以用于 页面自动化 ， 网络监测 ， 网页截屏 ，以及 无界面测试 等。

所以，可以把phantomjs就想象成一个浏览器，它提供了很多浏览器级别的api，供开发者使用。它可以注入本地，或者远程js代码到目标页面，对于自动化模拟用户操作很有帮助。

可以在目标页面沙箱执行js代码。

可以与断言库结合，利用console报表与onMessage事件通信，在真实环境下跑单侧

> 总结：灵活性高，可以做爬虫，可以做测试，可以做监控，但对代码质量要求也高，同步，异步代码组织困难。

____

> [casperjs](http://docs.casperjs.org/en/latest/installation.html)

![](http://o99eh3ii0.bkt.clouddn.com//16-9-9/35599761.jpg)
casperjs是基于phantomjs封装的一个web应用测试框架。

它封装了phantomjs的api，并提供了一套高级的测试api,以及断言库。开发者不用自己去维护phantomjs的异步，同步代码，执行顺序等问题。更专注于浏览器测试本身。

可以支持单元测试和浏览器测试,但是不支持其他的断言库

> 总结：web测试的最佳选择，简单，完整。

____

> slimerjs


#### 3、集成方案

> [karma](https://www.npmjs.com/package/karma)

前端集成测试框架，本身不提供测试库，支持主流的测试框架。管理依赖，复杂测试。支持生成代码覆盖率报表。

![](http://o99eh3ii0.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-08-31%20%E4%B8%8B%E5%8D%884.43.54.png)

> 总结：强烈推荐，管理各种依赖，测试框架。专注于测试本身



